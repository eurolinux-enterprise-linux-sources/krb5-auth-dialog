Adapted from the upstream commit: https://mail.gnome.org/archives/commits-list/2010-June/msg05967.html
Original author: Guido GÃ¼nther <guidog@src.gnome.org>

diff -uNr krb5-auth-dialog-0.13.org/src/krb5-auth-dialog.c krb5-auth-dialog-0.13/src/krb5-auth-dialog.c
--- krb5-auth-dialog-0.13.org/src/krb5-auth-dialog.c	2009-09-29 00:11:44.000000000 +0800
+++ krb5-auth-dialog-0.13/src/krb5-auth-dialog.c	2012-10-10 16:49:27.492394913 +0800
@@ -228,9 +228,8 @@
 		ka_applet_set_tgt_renewable(applet, TRUE);
 	}
 
-	krb5_free_cred_contents (kcontext, &my_creds);
-
 out:
+	krb5_free_cred_contents (kcontext, &my_creds);
 	ka_applet_update_status(applet, creds_expiry);
 	return retval;
 }
@@ -824,6 +823,7 @@
 
 	retval = ka_get_tgt_from_ccache (kcontext, &my_creds);
 	if (!retval) {
+	krb5_free_cred_contents (kcontext, &my_creds);
 		krb5_cc_close (kcontext, ccache);
 		return -1;
 	}
@@ -832,7 +832,7 @@
 	set_options_from_creds (applet, kcontext, &my_creds, &opts);
 
 	if (ka_applet_get_tgt_renewable(applet)) {
-
+	krb5_free_cred_contents (kcontext, &my_creds);
 		retval = get_renewed_creds (kcontext, &my_creds, kprincipal, ccache, NULL);
 		if (retval)
 			goto out;
